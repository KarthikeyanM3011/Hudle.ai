<%- include('layout', { body: `
    <div class="container py-4">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title mb-0">
                            <i class="fas fa-user me-2"></i>My Profile
                        </h3>
                    </div>
                    <div class="card-body">
                        <!-- Profile Overview -->
                        <div class="row mb-4">
                            <div class="col-md-3 text-center">
                                <div class="profile-avatar mb-3">
                                    <% if (profile.avatar) { %>
                                        <img src="<%= profile.avatar %>" alt="Profile" class="rounded-circle mb-2" id="profileImage">
                                    <% } else { %>
                                        <div class="avatar-placeholder bg-primary text-white rounded-circle d-flex align-items-center justify-content-center mb-2" id="profileImage">
                                            <i class="fas fa-user fa-3x"></i>
                                        </div>
                                    <% } %>
                                    <button class="btn btn-sm btn-outline-primary" onclick="changeAvatar()">
                                        <i class="fas fa-camera me-1"></i>Change Photo
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-9">
                                <h4 class="fw-bold"><%= profile.firstName %> <%= profile.lastName %></h4>
                                <p class="text-muted mb-3"><%= profile.email %></p>
                                <div class="row">
                                    <div class="col-sm-4">
                                        <div class="stat-item text-center">
                                            <h5 class="fw-bold text-primary"><%= stats.totalCoaches %></h5>
                                            <small class="text-muted">AI Coaches</small>
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="stat-item text-center">
                                            <h5 class="fw-bold text-success"><%= stats.totalMeetings %></h5>
                                            <small class="text-muted">Total Sessions</small>
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="stat-item text-center">
                                            <h5 class="fw-bold text-info"><%= Math.round(stats.totalMinutes / 60) %>h</h5>
                                            <small class="text-muted">Coaching Hours</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
    
                        <!-- Profile Tabs -->
                        <ul class="nav nav-tabs" id="profileTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="personal-tab" data-bs-toggle="tab" data-bs-target="#personal" type="button" role="tab">
                                    <i class="fas fa-user me-1"></i>Personal Info
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="security-tab" data-bs-toggle="tab" data-bs-target="#security" type="button" role="tab">
                                    <i class="fas fa-lock me-1"></i>Security
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="preferences-tab" data-bs-toggle="tab" data-bs-target="#preferences" type="button" role="tab">
                                    <i class="fas fa-cog me-1"></i>Preferences
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="activity-tab" data-bs-toggle="tab" data-bs-target="#activity" type="button" role="tab">
                                    <i class="fas fa-chart-line me-1"></i>Activity
                                </button>
                            </li>
                        </ul>
    
                        <div class="tab-content mt-4" id="profileTabContent">
                            <!-- Personal Information Tab -->
                            <div class="tab-pane fade show active" id="personal" role="tabpanel">
                                <form action="/profile/update" method="POST" id="personalInfoForm">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="firstName" class="form-label">First Name</label>
                                                <input type="text" class="form-control" id="firstName" name="firstName" 
                                                       value="<%= profile.firstName %>" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="lastName" class="form-label">Last Name</label>
                                                <input type="text" class="form-control" id="lastName" name="lastName" 
                                                       value="<%= profile.lastName %>" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="email" class="form-label">Email Address</label>
                                        <input type="email" class="form-control" id="email" value="<%= profile.email %>" disabled>
                                        <div class="form-text">Email address cannot be changed. Contact support if needed.</div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="timezone" class="form-label">Timezone</label>
                                        <select class="form-select" id="timezone" name="timezone">
                                            <option value="UTC">UTC (Coordinated Universal Time)</option>
                                            <option value="America/New_York">Eastern Time (ET)</option>
                                            <option value="America/Chicago">Central Time (CT)</option>
                                            <option value="America/Denver">Mountain Time (MT)</option>
                                            <option value="America/Los_Angeles">Pacific Time (PT)</option>
                                            <option value="Europe/London">London (GMT)</option>
                                            <option value="Europe/Paris">Paris (CET)</option>
                                            <option value="Asia/Tokyo">Tokyo (JST)</option>
                                            <option value="Asia/Kolkata" selected>India Standard Time (IST)</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="bio" class="form-label">Bio (Optional)</label>
                                        <textarea class="form-control" id="bio" name="bio" rows="3" 
                                                  placeholder="Tell us about yourself and your coaching goals..."></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-2"></i>Save Changes
                                    </button>
                                </form>
                            </div>
    
                            <!-- Security Tab -->
                            <div class="tab-pane fade" id="security" role="tabpanel">
                                <div class="security-section">
                                    <h5 class="fw-bold mb-3">Change Password</h5>
                                    <form action="/profile/change-password" method="POST" id="passwordForm">
                                        <div class="mb-3">
                                            <label for="currentPassword" class="form-label">Current Password</label>
                                            <input type="password" class="form-control" id="currentPassword" name="currentPassword" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="newPassword" class="form-label">New Password</label>
                                            <input type="password" class="form-control" id="newPassword" name="newPassword" required>
                                            <div class="form-text">Password must be at least 8 characters with uppercase, lowercase, and numbers.</div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="confirmNewPassword" class="form-label">Confirm New Password</label>
                                            <input type="password" class="form-control" id="confirmNewPassword" name="confirmNewPassword" required>
                                        </div>
                                        <button type="submit" class="btn btn-warning">
                                            <i class="fas fa-key me-2"></i>Change Password
                                        </button>
                                    </form>
    
                                    <hr class="my-4">
    
                                    <h5 class="fw-bold mb-3">Account Security</h5>
                                    <div class="security-info">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <div>
                                                <strong>Two-Factor Authentication</strong>
                                                <br><small class="text-muted">Add an extra layer of security to your account</small>
                                            </div>
                                            <button class="btn btn-outline-primary btn-sm">
                                                Enable 2FA
                                            </button>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <div>
                                                <strong>Login Notifications</strong>
                                                <br><small class="text-muted">Get notified of login attempts</small>
                                            </div>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="loginNotifications" checked>
                                            </div>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>Session Management</strong>
                                                <br><small class="text-muted">Manage active sessions</small>
                                            </div>
                                            <button class="btn btn-outline-secondary btn-sm">
                                                View Sessions
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
    
                            <!-- Preferences Tab -->
                            <div class="tab-pane fade" id="preferences" role="tabpanel">
                                <form action="/profile/preferences" method="POST" id="preferencesForm">
                                    <h5 class="fw-bold mb-3">Coaching Preferences</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="defaultDuration" class="form-label">Default Session Duration</label>
                                                <select class="form-select" id="defaultDuration" name="defaultDuration">
                                                    <option value="30">30 minutes</option>
                                                    <option value="45">45 minutes</option>
                                                    <option value="60" selected>60 minutes</option>
                                                    <option value="90">90 minutes</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="preferredMode" class="form-label">Preferred Session Mode</label>
                                                <select class="form-select" id="preferredMode" name="preferredMode">
                                                    <option value="avatar" selected>Avatar Mode</option>
                                                    <option value="audio-only">Audio Only</option>
                                                    <option value="video">Video Mode</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
    
                                    <h5 class="fw-bold mb-3 mt-4">Notifications</h5>
                                    <div class="notification-preferences">
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" id="emailReminders" name="notifications[]" value="email_reminders" checked>
                                            <label class="form-check-label" for="emailReminders">
                                                Email reminders for scheduled sessions
                                            </label>
                                        </div>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" id="progressUpdates" name="notifications[]" value="progress_updates" checked>
                                            <label class="form-check-label" for="progressUpdates">
                                                Weekly progress updates
                                            </label>
                                        </div>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" id="newFeatures" name="notifications[]" value="new_features">
                                            <label class="form-check-label" for="newFeatures">
                                                Notifications about new features
                                            </label>
                                        </div>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" id="marketingEmails" name="notifications[]" value="marketing">
                                            <label class="form-check-label" for="marketingEmails">
                                                Marketing emails and tips
                                            </label>
                                        </div>
                                    </div>
    
                                    <h5 class="fw-bold mb-3 mt-4">Privacy</h5>
                                    <div class="privacy-settings">
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" id="profileVisible" name="privacy[]" value="profile_visible">
                                            <label class="form-check-label" for="profileVisible">
                                                Make my profile visible to other users
                                            </label>
                                        </div>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" id="shareProgress" name="privacy[]" value="share_progress">
                                            <label class="form-check-label" for="shareProgress">
                                                Share my progress in community features
                                            </label>
                                        </div>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" id="analyticsOptOut" name="privacy[]" value="analytics_opt_out">
                                            <label class="form-check-label" for="analyticsOptOut">
                                                Opt out of usage analytics
                                            </label>
                                        </div>
                                    </div>
    
                                    <button type="submit" class="btn btn-primary mt-3">
                                        <i class="fas fa-save me-2"></i>Save Preferences
                                    </button>
                                </form>
                            </div>
    
                            <!-- Activity Tab -->
                            <div class="tab-pane fade" id="activity" role="tabpanel">
                                <h5 class="fw-bold mb-3">Account Activity</h5>
                                
                                <!-- Activity Stats -->
                                <div class="row mb-4">
                                    <div class="col-md-3">
                                        <div class="activity-stat text-center p-3 bg-light rounded">
                                            <h4 class="text-primary fw-bold"><%= new Date(profile.createdAt).getFullYear() %></h4>
                                            <small class="text-muted">Member Since</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="activity-stat text-center p-3 bg-light rounded">
                                            <h4 class="text-success fw-bold"><%= stats.totalMeetings %></h4>
                                            <small class="text-muted">Sessions Completed</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="activity-stat text-center p-3 bg-light rounded">
                                            <h4 class="text-info fw-bold"><%= stats.totalCoaches %></h4>
                                            <small class="text-muted">Coaches Created</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="activity-stat text-center p-3 bg-light rounded">
                                            <h4 class="text-warning fw-bold"><%= Math.round(stats.totalMinutes / 60) %></h4>
                                            <small class="text-muted">Hours Coached</small>
                                        </div>
                                    </div>
                                </div>
    
                                <!-- Recent Activity -->
                                <div class="recent-activity">
                                    <h6 class="fw-bold mb-3">Recent Activity</h6>
                                    <div class="activity-feed">
                                        <div class="activity-item d-flex align-items-center mb-3">
                                            <div class="activity-icon bg-success text-white rounded-circle me-3">
                                                <i class="fas fa-user-plus"></i>
                                            </div>
                                            <div>
                                                <div class="fw-semibold">Account created</div>
                                                <small class="text-muted"><%= new Date(profile.createdAt).toLocaleDateString() %></small>
                                            </div>
                                        </div>
                                        <div class="activity-item d-flex align-items-center mb-3">
                                            <div class="activity-icon bg-primary text-white rounded-circle me-3">
                                                <i class="fas fa-robot"></i>
                                            </div>
                                            <div>
                                                <div class="fw-semibold">Created first AI coach</div>
                                                <small class="text-muted">Welcome to Huddle.ai!</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
    
                                <!-- Data Export -->
                                <div class="data-section mt-4">
                                    <h6 class="fw-bold mb-3">Data Management</h6>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-outline-primary btn-sm">
                                            <i class="fas fa-download me-1"></i>Export Data
                                        </button>
                                        <button class="btn btn-outline-danger btn-sm" onclick="confirmDeleteAccount()">
                                            <i class="fas fa-trash me-1"></i>Delete Account
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Avatar Upload Modal -->
    <div class="modal fade" id="avatarModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Change Profile Photo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="avatarForm" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="avatarFile" class="form-label">Choose new photo</label>
                            <input type="file" class="form-control" id="avatarFile" accept="image/*" required>
                            <div class="form-text">Recommended: Square image, at least 200x200 pixels, under 5MB</div>
                        </div>
                        <div class="avatar-preview text-center" id="avatarPreview" style="display: none;">
                            <img id="previewImage" class="rounded-circle" style="width: 150px; height: 150px; object-fit: cover;">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="uploadAvatar()">Save Photo</button>
                </div>
            </div>
        </div>
    </div>
    
    <style>
    .profile-avatar img,
    .avatar-placeholder {
        width: 120px;
        height: 120px;
        object-fit: cover;
    }
    
    .stat-item {
        padding: 1rem 0;
    }
    
    .activity-icon {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .activity-stat {
        margin-bottom: 1rem;
    }
    
    .security-section .form-check-input:checked {
        background-color: #198754;
        border-color: #198754;
    }
    </style>
    
    <script>
    // Form validation
    document.getElementById('passwordForm').addEventListener('submit', function(e) {
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmNewPassword').value;
        
        if (newPassword !== confirmPassword) {
            e.preventDefault();
            alert('New passwords do not match!');
            return;
        }
        
        if (newPassword.length < 8) {
            e.preventDefault();
            alert('Password must be at least 8 characters long!');
            return;
        }
    });
    
    // Avatar upload
    function changeAvatar() {
        new bootstrap.Modal(document.getElementById('avatarModal')).show();
    }
    
    document.getElementById('avatarFile').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('previewImage').src = e.target.result;
                document.getElementById('avatarPreview').style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    });
    
    function uploadAvatar() {
        const file = document.getElementById('avatarFile').files[0];
        if (!file) {
            alert('Please select a file');
            return;
        }
        
        const formData = new FormData();
        formData.append('avatar', file);
        
        fetch('/profile/upload-avatar', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('profileImage').src = data.avatarUrl;
                bootstrap.Modal.getInstance(document.getElementById('avatarModal')).hide();
            } else {
                alert('Upload failed: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Upload failed');
        });
    }
    
    function confirmDeleteAccount() {
        if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
            if (confirm('This will permanently delete all your coaches, sessions, and data. Type "DELETE" to confirm:')) {
                const confirmation = prompt('Type "DELETE" to confirm account deletion:');
                if (confirmation === 'DELETE') {
                    // Implement account deletion
                    alert('Account deletion functionality would be implemented here');
                }
            }
        }
    }
    
    // Auto-save preferences
    document.querySelectorAll('#preferences input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            // Auto-save preferences
            const formData = new FormData(document.getElementById('preferencesForm'));
            fetch('/profile/preferences', {
                method: 'POST',
                body: formData
            }).catch(console.error);
        });
    });
    </script>
    `}) %>